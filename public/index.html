<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ðŸš€ A sophisticated tool for optimizing npm package visibility.">
  <meta name="keywords" content="npm, package views, automation, ðŸš€ boost views">
  <meta name="author" content="vo_e on Discord">
  <meta property="og:image" content="./Images/Logo-removebg-preview copy.png">
  <!-- SEO Meta Tags -->
  <meta name="robots" content="index, follow">
  <meta name="googlebot" content="index, follow">
  <meta name="bingbot" content="index, follow">
  <meta name="yandex" content="index, follow">
  <link rel="icon" href="./Images/Logo-removebg-preview copy.png"sizes="32x32 type="image/png">

  <!-- Social Meta Tags -->
  <meta property="og:title" content="ViewElevate">
  <meta property="og:description" content="ðŸš€ A sophisticated tool for optimizing npm package visibility.">
  <meta property="og:type" content="website">
  <meta property="og:url" content="https://viewelevate-npm.onrender.com">
  <meta property="og:image" content="https://viewelevate-npm.onrender.com/images/preview-image.jpg">
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:title" content="ViewElevate">
  <meta property="twitter:description" content="A sophisticated tool for optimizing npm package visibility.">
  <meta property="twitter:image" content="https://viewelevate-npm.onrender.com/images/preview-image.jpg">
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

  <title>ViewElevate</title>
  <style>
body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  margin: 0;
  padding: 0;
  background-color: #1a1a1a; /* Darker gray background */
  color: #fff;
  display: flex;
  align-items: center;
  justify-content: center;
  min-height: 100vh;
}

#main-container {
  display: flex;
}

#sidebar {
  background-color: #111; /* Dark background for the sidebar */
  padding: 20px;
  width: 250px; /* Adjust the width as needed */
  box-shadow: 2px 0 5px rgba(0, 0, 0, 0.5); /* Sidebar shadow */
}

#container {
  background-color: rgba(17, 17, 17, 0.9); /* Slightly transparent black */
  border-radius: 15px;
  padding: 20px;
  width: 400px;
  box-shadow: 0 0 20px rgba(0, 0, 0, 0.7); /* Increased shadow */
  text-align: center;
  margin-left: 20px; /* Adjust the margin as needed */
}

#logo {
  max-width: 100px; /* Adjust the size as needed */
  margin-bottom: 20px;
}

h1 {
  color: #3498db; /* Blue color for emphasis */
  font-size: 24px;
  margin-bottom: 15px;
}

label {
  display: block;
  margin-bottom: 8px;
  color: #fff;
}

input,
button,
select {
  width: 100%;
  padding: 12px; /* Increased padding */
  margin-bottom: 15px;
  box-sizing: border-box;
  border: none;
  border-radius: 8px;
  background-color: rgba(68, 68, 68, 0.8); /* Slightly transparent dark gray */
  color: #fff;
  outline: none;
  transition: background-color 0.3s ease;
}

button {
  background-color: #3498db; /* Blue color for emphasis */
  color: #fff;
  cursor: pointer;
}

button:hover {
  background-color: #2980b9; /* Slightly darker blue on hover */
}

#progress-container {
  margin-top: 15px;
  background-color: rgba(68, 68, 68, 0.8); /* Slightly transparent dark gray */
  border-radius: 8px;
  height: 10px;
  overflow: hidden;
  display: none;
}

#progress {
  height: 100%;
  width: 0;
  background-color: #3498db; /* Blue color for emphasis */
  transition: width 0.3s ease-in-out;
  border-radius: 8px;
  display: none;
}

.response {
  margin-top: 20px;
  color: #b3b3b3;
}

.loader {
  border: 6px solid #f3f3f3;
  border-top: 6px solid #3498db; /* Blue color for emphasis */
  border-radius: 50%;
  width: 30px;
  height: 30px;
  animation: spin 1s linear infinite;
  margin: 0 auto;
  display: none;
}

@keyframes spin {
  0% {
    transform: rotate(0deg);
  }

  100% {
    transform: rotate(360deg);
  }
}

  </style>
</head>

<body>



  <div id="container">
    <img id="logo" src="./Images/Logo-removebg-preview.png" alt="ViewElevate Logo">
    <h1>ViewElevate</h1>

    <form id="packageForm">
      <label for="packageName">Package Name:</label>
      <input type="text" id="packageName" name="packageName" required>

      <label for="downloadCount">View Count:</label>
      <input type="number" id="downloadCount" name="downloadCount" min="1" required>

      <label for="waitTime">Wait Time (seconds):</label>
      <input type="number" id="waitTime" name="waitTime" min="1" value="5" required>

      <button type="button" id="startViewButton" onclick="downloadPackage()">Start View Bot</button>
      <div class="loader" id="loader"></div>
      <div id="progress-container">
        <div class="progress" id="progress"></div>
      </div>
    </form>

    <div id="response" class="response"></div>
  </div>

  <script>
   async function downloadPackage() {
  const packageName = document.getElementById('packageName').value;
  const downloadCount = document.getElementById('downloadCount').value;
  const waitTime = document.getElementById('waitTime').value;
  const loader = document.getElementById('loader');
  const progressElement = document.getElementById('progress');
  const responseElement = document.getElementById('response');
  const startViewButton = document.getElementById('startViewButton'); // Add this line
const progresscon = document.getElementById('progress-container')
  responseElement.innerHTML = `Initiating process to send ${downloadCount} views to the package named ${packageName}.`;

  // Show loader and progress bar
  //loader.style.display = 'block';
  progressElement.style.width = '0%';
  
  // Disable the start button
  startViewButton.disabled = true;
  startViewButton.style.backgroundColor = 'grey'; // You can customize the gray color

  let data = {}; // Initialize data outside the try block

  try {
    // Make a POST request to the server
    const response = await fetch(`/download/${packageName}/${downloadCount}`, { method: 'POST' });

    // Clone the response before reading the body
    const clonedResponse = response.clone();

    // Get the response body as JSON
    data = await response.json();

    // Set up a readable stream from the cloned response
    const reader = clonedResponse.body.getReader();
    progresscon.style.display = 'block';
    // Get the total content length from the headers
    const contentLength = +clonedResponse.headers.get('Content-Length');
    let receivedLength = 0; // Bytes received

    // Update the progress bar width gradually with a delay
const updateProgressBarWithDelay = async (currentProgress, targetProgress) => {
  await simulateProgressIncrease(currentProgress, targetProgress);
  //await simulateProgressDecrease(targetProgress, currentProgress);
};

// Function to simulate a gradual increase in progress
async function simulateProgressIncrease(currentWidth, targetWidth) {
  const increment = 1; // Increase by 1% at a time
  while (parseInt(currentWidth) < parseInt(targetWidth)) {
    currentWidth = `${parseInt(currentWidth) + increment}%`;
    await sleep(20); // Adjust the delay for smoother animation
    progressElement.style.width = currentWidth;
  }
}

// Function to simulate a delay using Promises
function sleep(ms) {
  return new Promise(resolve => setTimeout(resolve, ms));
}

// Function to simulate a gradual decrease in progress
async function simulateProgressDecrease(currentWidth, targetWidth) {
  const decrement = 1; // Decrease by 1% at a time
  while (parseInt(currentWidth) > parseInt(targetWidth)) {
    currentWidth = `${parseInt(currentWidth) - decrement}%`;
    await sleep(20); // Adjust the delay for smoother animation
    progressElement.style.width = currentWidth;
  }
}

progressElement.style.display = 'block';

    while (true) {
      const { done, value } = await reader.read();

      if (done) {
        // Exit the loop when the response has been fully read
        break;
      }

      receivedLength += value.length;

      // Calculate the progress percentage
      const progress = (receivedLength / contentLength) * 100;
      // Update the progress bar width
       // Update the progress bar width gradually
  updateProgressBarWithDelay(progressElement.style.width, `${progress}%`);
    }

    // Simulate asynchronous operation (e.g., waiting for changes on the npm site)
    await simulateDelay(waitTime * 1000);

    if(data.message){
      responseElement.innerHTML = `<p>${data.message}</p>`;
      responseElement.style.color = '#4CAF50'; // Green color for success

    }
    if(data.error){
      responseElement.innerHTML = `<p>${data.error}</p>`;
      responseElement.style.color = '#FF6347'; // Green color for success

    }
  } catch (error) {
    console.error(error);
    responseElement.innerHTML = `<p class="error">An error occurred. Please check the console for details.</p>`;
    responseElement.style.color = '#FF6347'; // Tomato color for error
  } finally {
    // Hide loader after completion
    loader.style.display = 'none';
    // Ensure the progress bar is at 100% even if the content is not fully received
    //progressElement.style.width = '100%';
    // Enable and style the start button back
    startViewButton.disabled = false;
    startViewButton.style.backgroundColor = '#3498db'; // Blue color (customize as needed)
    setTimeout(() => {
      responseElement.innerHTML = '';
      responseElement.style.color = '';
      progressElement.style.width = '0%';
      progressElement.style.display = 'none';
      progresscon.style.display = 'none';
    }, 4000);
  }
}




    // Function to simulate asynchronous delay
    function simulateDelay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }
  </script>
</body>
</html>
